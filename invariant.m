% Computing inner-approximations of reachable sets for Example 1 based on the semi-definite programming method in
% [1]
% [1]. M. Korda, D. Henrion, and C. N. Jones. Inner approximations of the region of attraction for polynomial dynamical systems. 
 %IFAC Proceedings Volumes, 46(23):534¨C539, 2013.
%   min_{V,w,s1,s2,s3,s4,s5,s6,s7,s8} obj
%  s.t.
% -V_derivative-s1(x,t)*t*(T-t)-s2(x,t)*g \in sos,
% w-V_0-1-s3(x)*g \in sos, 
% V_1-s4(x)*g+s5(x)*V0 \in sos,
% V(x,t)-s6(x,t)*t*(T-t)-s7(x,t)*g \in sos
% w-s8(x)*g \in sos
% where V_derivative=\frac{\partial V}{\partial t}+\frac{\partial
% V}{\partial x}*f and s1,s2,s4,s5,s7,s9 are sos polynomials.
%------------------------------------------------------------------------------------------------------------
% f -- vector field;
% T -- Time duration;
% t_0 -- the initial time: t_0 =0 
% V0 -- the polynomial defining the set of initial states \mathcal{X}_0={x:V0(x)<=0};
% g -- the polynomial defining the compact set X={x: g>=0} including the set of states visited by the system within
% the time interval [0,T]
% degree -- the degree of polynomial V;
% degree_w --  the degree of polynomial w and sos polynomial s8;
% degree1 -- the degree of sos polynomials s1 s2 s3 s4 s5 s6 s7;
%-------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------
clear;
clc;
sdpvar x y;
sdpvar d;
a=0;

% f=[-2*y;x+0.5*(x^2-0.21)*y];
% f=[0.1+y; -0.2-x];
f = [-2*y;0.8*x+5*(x^2-0.21)*y];
%T=1;

%f=[-2*y;x+0.5*(x^2-0.21)*y]; 

%h_1=x^2+y^2-1;
h_1=-(x+0.5)^2-(y+0.5)^2+0.2;
h_d=0;
xd=[x y d];
x1=[x y];
%------------------------------------
% the parameter inputs g degree,degree_w and obj for obtaining the results illustrated in
% Fig. 7 in our HSCC paper
%-------------------------------
h=1-x^2-y^2;
Degree=10;

[V,coe]= polynomial(x1,Degree);

V1=jacobian(V,x1)*f;

% 10
% obj=3.45575*coe(1) + 0.950332*coe(4) + 0.950332*coe(6) + 0.522682*coe(11) + 0.174227*coe(13) + 0.522682*coe(15) + 0.359344*coe(22) + 0.0718688*coe(24) + 0.0718688*coe(26) + 0.359344*coe(28) + 0.276695*coe(37) + 0.0395279*coe(39) + 0.0237167*coe(41) + 0.0395279*coe(43) + 0.276695*coe(45) + 0.228273*coe(56) + 0.0253637*coe(58) + 0.0108702*coe(60) + 0.0108702*coe(62) + 0.0253637*coe(64) + 0.228273*coe(66);
%14
%obj=3.45575*coe(1) + 0.950332*coe(4) + 0.950332*coe(6) + 0.522682*coe(11) + 0.174227*coe(13) + 0.522682*coe(15) + 0.359344*coe(22) + 0.0718688*coe(24) + 0.0718688*coe(26) + 0.359344*coe(28) + 0.276695*coe(37) + 0.0395279*coe(39) + 0.0237167*coe(41) + 0.0395279*coe(43) + 0.276695*coe(45) + 0.228273*coe(56) + 0.0253637*coe(58) + 0.0108702*coe(60) + 0.0108702*coe(62) + 0.0253637*coe(64) + 0.228273*coe(66) + 0.197293*coe(79) + 0.0179358*coe(81) + 0.00597859*coe(83) + 0.00427042*coe(85) + 0.00597859*coe(87) + 0.0179358*coe(89) + 0.197293*coe(91) + 0.176331*coe(106) + 0.0135639*coe(108) + 0.00369925*coe(110) + 0.00205514*coe(112) + 0.00205514*coe(114) + 0.00369925*coe(116) + 0.0135639*coe(118) + 0.176331*coe(120);
%16
%obj=3.45575*coe(1) + 0.950332*coe(4) + 0.950332*coe(6) + 0.522682*coe(11) + 0.174227*coe(13) + 0.522682*coe(15) + 0.359344*coe(22) + 0.0718688*coe(24) + 0.0718688*coe(26) + 0.359344*coe(28) + 0.276695*coe(37) + 0.0395279*coe(39) + 0.0237167*coe(41) + 0.0395279*coe(43) + 0.276695*coe(45) + 0.228273*coe(56) + 0.0253637*coe(58) + 0.0108702*coe(60) + 0.0108702*coe(62) + 0.0253637*coe(64) + 0.228273*coe(66) + 0.197293*coe(79) + 0.0179358*coe(81) + 0.00597859*coe(83) + 0.00427042*coe(85) + 0.00597859*coe(87) + 0.0179358*coe(89) + 0.197293*coe(91) + 0.176331*coe(106) + 0.0135639*coe(108) + 0.00369925*coe(110) + 0.00205514*coe(112) + 0.00205514*coe(114) + 0.00369925*coe(116) + 0.0135639*coe(118) + 0.176331*coe(120) + 0.161637*coe(137) + 0.0107758*coe(139) + 0.00248672*coe(141) + 0.00113033*coe(143) + 0.000879143*coe(145) + 0.00113033*coe(147) + 0.00248672*coe(149) + 0.0107758*coe(151) + 0.161637*coe(153);
%---------------------------------
%---------------------------------
%obj=4.93480220054*coe_v(1)-0.0489013*coe_v(2)-0.04881*coe_v(3)+0.000199567*coe_v(4)+0.00488244*coe_v(5)+0.817192*coe_v(6)-0.0316059*coe_v(7)+0.805847*coe_v(8)+0.0103392*coe_v(9)+0.0229703*coe_v(10)+0.82837*coe_v(11)-0.0274758*coe_v(12)+0.0069504*coe_v(13)+0.000625454*coe_v(14)+0.8172*coe_v(15)+0.0160989*coe_v(16)-0.00380147*coe_v(17)+0.00368445*coe_v(18)+0.00779255*coe_v(19)-0.00898177*coe_v(20)-0.00276453*coe_v(21)+0.00605272*coe_v(22)-0.00458345*coe_v(23)+0.0124122*coe_v(24)-0.0233412*coe_v(25)-0.0102636*coe_v(26)+0.00379024*coe_v(27)+0.0022559*coe_v(28)-0.00571642*coe_v(29)+0.00368688*coe_v(30)+0.0153865*coe_v(31)-0.00239953*coe_v(32)+0.00989772*coe_v(33)+0.00118125*coe_v(34)+0.0153063*coe_v(35)+0.296555*coe_v(36)-0.00442252*coe_v(37)+0.1102*coe_v(38)-0.00654384*coe_v(39)+0.305988*coe_v(40)-0.00330629*coe_v(41)-0.000181183*coe_v(42)+0.00361497*coe_v(43)-0.0038502*coe_v(44)+0.101806*coe_v(45)+0.00141628*coe_v(46)+0.106988*coe_v(47)+0.00374855*coe_v(48)-0.00543628*coe_v(49)+0.307255*coe_v(50)-0.00893427*coe_v(51)-0.00288953*coe_v(52)+0.000846685*coe_v(53)+0.00366017*coe_v(54)+0.000911465*coe_v(55)+0.000284478*coe_v(56)+0.0029186*coe_v(57)-0.00167295*coe_v(58)+0.00416894*coe_v(59)-0.008393*coe_v(60)+0.101399*coe_v(61)+0.00166156*coe_v(62)+0.0979343*coe_v(63)+0.000843778*coe_v(64)+0.00151939*coe_v(65)+0.100807*coe_v(66)+0.0132668*coe_v(67)+0.0035213*coe_v(68)+0.00394714*coe_v(69)+0.302663*coe_v(70)-0.00553397*coe_v(71)-0.00115582*coe_v(72)+0.00293095*coe_v(73)+0.00140016*coe_v(74)-0.00113021*coe_v(75)+0.00859893*coe_v(76)+0.000362631*coe_v(77)-0.000394339*coe_v(78)-0.00148454*coe_v(79)+0.00269674*coe_v(80)+0.000453179*coe_v(81)+0.00146637*coe_v(82)-0.00149089*coe_v(83)-0.000518555*coe_v(84)+0.00248971*coe_v(85)-0.000343692*coe_v(86)+0.000185365*coe_v(87)+0.00149875*coe_v(88)-0.00530873*coe_v(89)-0.00768566*coe_v(90)+0.00427644*coe_v(91)+0.00291264*coe_v(92)+0.000300854*coe_v(93)-0.000368477*coe_v(94)-0.00100499*coe_v(95)+0.00360858*coe_v(96)+0.00079218*coe_v(97)-0.000140963*coe_v(98)-0.00133031*coe_v(99)-0.00273563*coe_v(100)-0.000327726*coe_v(101)-0.00073456*coe_v(102)-0.00160753*coe_v(103)-0.0022024*coe_v(104)+0.000503809*coe_v(105)-0.00465523*coe_v(106)-0.00134395*coe_v(107)-0.000147628*coe_v(108)+0.000597383*coe_v(109)+0.000686684*coe_v(110)-0.00047279*coe_v(111)-0.000749954*coe_v(112)+0.000254724*coe_v(113)+0.000185357*coe_v(114)+0.000567672*coe_v(115)-0.00280703*coe_v(116)+0.00158572*coe_v(117)+0.000782739*coe_v(118)-0.00213215*coe_v(119)-0.000946129*coe_v(120)-0.00107231*coe_v(121)+0.000488614*coe_v(122)+0.0024816*coe_v(123)+0.00196855*coe_v(124)-0.00385621*coe_v(125)+0.00410371*coe_v(126)+0.160501*coe_v(127)+0.000951829*coe_v(128)+0.0295117*coe_v(129)-0.000850057*coe_v(130)+0.0333053*coe_v(131)+0.00417275*coe_v(132)+0.155301*coe_v(133)+0.000220513*coe_v(134)-0.00094948*coe_v(135)+0.000325066*coe_v(136)-0.000680696*coe_v(137)-0.00100678*coe_v(138)-0.00194718*coe_v(139)+0.0304315*coe_v(140)+0.000420628*coe_v(141)+0.0103259*coe_v(142)-0.000422922*coe_v(143)+0.030851*coe_v(144)+2.26714e-05*coe_v(145)+0.00022729*coe_v(146)+0.000661579*coe_v(147)+0.00374929*coe_v(148)+0.0305522*coe_v(149)+7.22571e-05*coe_v(150)+0.0291779*coe_v(151)-0.00164613*coe_v(152)-0.00145847*coe_v(153)+0.151938*coe_v(154)-0.00076493*coe_v(155)+0.000532355*coe_v(156)+0.000639783*coe_v(157)-0.000288092*coe_v(158)+0.000155718*coe_v(159)-0.00138506*coe_v(160)-6.93909e-05*coe_v(161)-0.000441658*coe_v(162)+0.000154783*coe_v(163)+0.000578136*coe_v(164)-0.00131064*coe_v(165)+0.000694167*coe_v(166)-0.000395941*coe_v(167)+9.71902e-05*coe_v(168)+8.54742e-05*coe_v(169)+0.00152911*coe_v(170)+0.000301782*coe_v(171)-0.000206518*coe_v(172)-0.00068333*coe_v(173)-0.000256104*coe_v(174)-0.00347802*coe_v(175)+0.0283913*coe_v(176)+0.000470939*coe_v(177)+0.0100226*coe_v(178)-3.01195e-06*coe_v(179)+0.0322964*coe_v(180)-0.000249436*coe_v(181)-0.000529661*coe_v(182)-8.07428e-05*coe_v(183)-0.000439475*coe_v(184)+0.0102473*coe_v(185)-0.000401444*coe_v(186)+0.0101515*coe_v(187)-0.000177772*coe_v(188)-0.00108652*coe_v(189)+0.0306443*coe_v(190)-0.000116705*coe_v(191)-0.000505615*coe_v(192)+0.00038116*coe_v(193)-0.000769015*coe_v(194)+5.27022e-05*coe_v(195)-0.000265814*coe_v(196)+0.00082597*coe_v(197)-8.06046e-05*coe_v(198)-0.000145449*coe_v(199)-0.000641968*coe_v(200)+0.0330006*coe_v(201)+0.000872256*coe_v(202)+0.032612*coe_v(203)+0.000223926*coe_v(204)+0.000255312*coe_v(205)+0.032612*coe_v(206)+0.00370705*coe_v(207)-0.00279334*coe_v(208)-6.51676e-05*coe_v(209)+0.162091*coe_v(210)-0.00254819*coe_v(211)-0.000908059*coe_v(212)-0.000239528*coe_v(213)-0.00146567*coe_v(214)+0.00064883*coe_v(215)-0.00102117*coe_v(216)+9.17043e-05*coe_v(217)-0.00729753*coe_v(218)-0.00223714*coe_v(219)-0.000164425*coe_v(220)-0.000393826*coe_v(221)+4.74656e-05*coe_v(222)-0.000266464*coe_v(223)+0.00086419*coe_v(224)-0.00150957*coe_v(225)+0.000480034*coe_v(226)-0.000310567*coe_v(227)+0.0002665*coe_v(228)-4.5603e-05*coe_v(229)-0.000242344*coe_v(230)+0.000681311*coe_v(231)+0.00147405*coe_v(232)-1.8965e-05*coe_v(233)+3.60589e-05*coe_v(234)+0.00022777*coe_v(235)-2.10674e-06*coe_v(236)+0.000756801*coe_v(237)-6.26459e-05*coe_v(238)-4.11295e-06*coe_v(239)-0.000692085*coe_v(240)+0.000401193*coe_v(241)-0.000283214*coe_v(242)-0.00134484*coe_v(243)-0.00200903*coe_v(244)+0.000642772*coe_v(245)-0.00284824*coe_v(246)+0.000601351*coe_v(247)-5.16271e-05*coe_v(248)+0.000164607*coe_v(249)+0.000515696*coe_v(250)+0.000459583*coe_v(251)-0.00141669*coe_v(252)+0.00044748*coe_v(253)+0.000172398*coe_v(254)-0.000198821*coe_v(255)-0.000219241*coe_v(256)+7.87351e-05*coe_v(257)+4.28247e-05*coe_v(258)+0.000159052*coe_v(259)+6.6515e-05*coe_v(260)+3.35962e-05*coe_v(261)+8.36265e-05*coe_v(262)-0.000170023*coe_v(263)-0.00069695*coe_v(264)+0.000243132*coe_v(265)-8.2679e-06*coe_v(266)+0.000123444*coe_v(267)-0.000128268*coe_v(268)+0.000394878*coe_v(269)-0.000188516*coe_v(270)-0.00078687*coe_v(271)+0.00017385*coe_v(272)+0.000630634*coe_v(273)-0.00156796*coe_v(274)-0.0012279*coe_v(275)+0.000576801*coe_v(276)+0.000152758*coe_v(277)-6.82414e-05*coe_v(278)+0.00026038*coe_v(279)-0.00146886*coe_v(280)+0.000153858*coe_v(281)+0.000286501*coe_v(282)+0.000207659*coe_v(283)-0.000259311*coe_v(284)+4.97895e-05*coe_v(285)+0.000207668*coe_v(286)+7.03016e-05*coe_v(287)-1.12634e-06*coe_v(288)+0.000104015*coe_v(289)+0.000270943*coe_v(290)-9.92594e-05*coe_v(291)-2.61273e-05*coe_v(292)-4.67053e-05*coe_v(293)+0.000170751*coe_v(294)+0.000291024*coe_v(295)-0.000499276*coe_v(296)+0.000294537*coe_v(297)+3.47684e-05*coe_v(298)-0.000540142*coe_v(299)+0.000364707*coe_v(300)-0.000117853*coe_v(301)+0.000162945*coe_v(302)-0.000275313*coe_v(303)-0.000160791*coe_v(304)+7.76681e-05*coe_v(305)+0.000122363*coe_v(306)-0.000226854*coe_v(307)-7.41826e-05*coe_v(308)-1.0174e-05*coe_v(309)-1.00438e-05*coe_v(310)+0.000272184*coe_v(311)+0.0002042*coe_v(312)-1.30829e-05*coe_v(313)-0.000722302*coe_v(314)+0.000263079*coe_v(315)-3.27584e-05*coe_v(316)+0.000114567*coe_v(317)+0.000186962*coe_v(318)+0.000346394*coe_v(319)+0.00120783*coe_v(320)+0.00131963*coe_v(321)-7.30225e-05*coe_v(322)-0.000613183*coe_v(323)-0.000219485*coe_v(324)-0.000144042*coe_v(325)-0.000137355*coe_v(326)+0.0018045*coe_v(327)-0.00316809*coe_v(328)+0.00486739*coe_v(329)+0.00271208*coe_v(330)+0.0867144*coe_v(331)+0.00046951*coe_v(332)+0.0132282*coe_v(333)-8.46513e-05*coe_v(334)+0.00764433*coe_v(335)+0.000467366*coe_v(336)+0.0137213*coe_v(337)+0.00201979*coe_v(338)+0.0908491*coe_v(339)-0.000814234*coe_v(340)-0.000794443*coe_v(341)+0.000381604*coe_v(342)-0.000394745*coe_v(343)-0.000154341*coe_v(344)+7.01624e-05*coe_v(345)-0.000252642*coe_v(346)+0.000337452*coe_v(347)+0.0129705*coe_v(348)+0.000193633*coe_v(349)+0.00266431*coe_v(350)+6.79675e-05*coe_v(351)+0.00272521*coe_v(352)+8.5361e-05*coe_v(353)+0.0128376*coe_v(354)+1.73496e-05*coe_v(355)-0.000109679*coe_v(356)+4.33136e-05*coe_v(357)+0.000141426*coe_v(358)+1.13227e-07*coe_v(359)-1.83909e-05*coe_v(360)+0.00683967*coe_v(361)+0.000142876*coe_v(362)+0.00271309*coe_v(363)-6.06493e-05*coe_v(364)+0.00737909*coe_v(365)+0.000305463*coe_v(366)-0.000229195*coe_v(367)+0.000128976*coe_v(368)+0.000473447*coe_v(369)+0.0128687*coe_v(370)+0.000128467*coe_v(371)+0.0123951*coe_v(372)+0.000555911*coe_v(373)-0.000224355*coe_v(374)+0.0928052*coe_v(375)-0.000663142*coe_v(376)-0.000118465*coe_v(377)+0.000347644*coe_v(378)-0.000111397*coe_v(379)-8.56185e-05*coe_v(380)-0.000390928*coe_v(381)-0.000206062*coe_v(382)+0.000113576*coe_v(383)+0.000394273*coe_v(384)+3.81979e-05*coe_v(385)-2.15887e-05*coe_v(386)+1.51191e-05*coe_v(387)+0.000131072*coe_v(388)-0.000167879*coe_v(389)+0.00036137*coe_v(390)-9.28972e-05*coe_v(391)+9.27577e-05*coe_v(392)-0.000104979*coe_v(393)+1.49006e-05*coe_v(394)-1.02033e-05*coe_v(395)-9.45309e-05*coe_v(396)+0.000403924*coe_v(397)+9.98575e-05*coe_v(398)-4.23544e-05*coe_v(399)+2.27105e-05*coe_v(400)+2.3754e-05*coe_v(401)+1.87199e-05*coe_v(402)+0.000130415*coe_v(403)+9.85164e-05*coe_v(404)-0.00026497*coe_v(405)+0.000239036*coe_v(406)+8.91529e-05*coe_v(407)-0.000439281*coe_v(408)-1.88809e-06*coe_v(409)-0.000251737*coe_v(410)+0.00086995*coe_v(411)+0.0124041*coe_v(412)+0.000175998*coe_v(413)+0.00251695*coe_v(414)-0.000107192*coe_v(415)+0.0027924*coe_v(416)+0.000147247*coe_v(417)+0.0133913*coe_v(418)+9.22422e-05*coe_v(419)+0.000125438*coe_v(420)+1.57139e-05*coe_v(421)+4.59623e-05*coe_v(422)+1.95862e-06*coe_v(423)+7.71195e-05*coe_v(424)+0.00283723*coe_v(425)+4.84125e-05*coe_v(426)+0.000860505*coe_v(427)-2.21013e-05*coe_v(428)+0.00274435*coe_v(429)-7.94786e-05*coe_v(430)+9.01954e-05*coe_v(431)-1.34265e-05*coe_v(432)-0.000132504*coe_v(433)+0.00270653*coe_v(434)-8.58728e-05*coe_v(435)+0.00249579*coe_v(436)+0.000661464*coe_v(437)-0.000146188*coe_v(438)+0.0139509*coe_v(439)-0.000202078*coe_v(440)+1.87972e-05*coe_v(441)+0.000201472*coe_v(442)+6.91133e-05*coe_v(443)+0.000103836*coe_v(444)+0.000666601*coe_v(445)+0.000203143*coe_v(446)+9.47016e-05*coe_v(447)-3.16991e-05*coe_v(448)+9.13017e-05*coe_v(449)-7.62173e-05*coe_v(450)+3.11666e-05*coe_v(451)+6.47289e-05*coe_v(452)+2.49376e-05*coe_v(453)-0.00011688*coe_v(454)-0.000109639*coe_v(455)-7.07965e-05*coe_v(456)+2.02107e-05*coe_v(457)+0.000356693*coe_v(458)+0.000239112*coe_v(459)-0.000352249*coe_v(460)+0.00703999*coe_v(461)-1.04553e-05*coe_v(462)+0.00249518*coe_v(463)+3.37208e-05*coe_v(464)+0.00794916*coe_v(465)-0.000140585*coe_v(466)-8.9839e-06*coe_v(467)+0.000162728*coe_v(468)-0.000123283*coe_v(469)+0.00245778*coe_v(470)+0.0001215*coe_v(471)+0.00245259*coe_v(472)+0.0001168*coe_v(473)+0.000209036*coe_v(474)+0.00795446*coe_v(475)-0.00011607*coe_v(476)-0.000303481*coe_v(477)-0.000196029*coe_v(478)-0.00107644*coe_v(479)-0.000141357*coe_v(480)+3.18276e-05*coe_v(481)+0.000204399*coe_v(482)-0.000292521*coe_v(483)+1.28457e-05*coe_v(484)+0.00105098*coe_v(485)+0.0137184*coe_v(486)-0.000272294*coe_v(487)+0.012936*coe_v(488)-0.000603632*coe_v(489)-0.000218463*coe_v(490)+0.01174*coe_v(491)+0.000712476*coe_v(492)-0.00235801*coe_v(493)-0.00186993*coe_v(494)+0.0875227*coe_v(495)-0.00581932*coe_v(496)-0.00119932*coe_v(497)-0.0012626*coe_v(498)+0.000763806*coe_v(499)-0.000380332*coe_v(500)-0.00022065*coe_v(501)+0.000118122*coe_v(502)-0.000308644*coe_v(503)+0.00260026*coe_v(504)+0.00973387*coe_v(505)+4.63731e-05*coe_v(506)+0.000486714*coe_v(507)+0.000203634*coe_v(508)+0.000109203*coe_v(509)-0.000248829*coe_v(510)-1.60269e-05*coe_v(511)+0.000237496*coe_v(512)-0.000313048*coe_v(513)-0.00160532*coe_v(514)-0.000679593*coe_v(515)-2.68132e-05*coe_v(516)+7.34359e-05*coe_v(517)-3.53814e-06*coe_v(518)+4.40402e-05*coe_v(519)-0.000106175*coe_v(520)+0.000258301*coe_v(521)-0.000389331*coe_v(522)+0.000784751*coe_v(523)+6.39289e-05*coe_v(524)-1.48355e-05*coe_v(525)+4.64628e-05*coe_v(526)+0.000108434*coe_v(527)-7.29824e-05*coe_v(528)+0.000167296*coe_v(529)-0.000421388*coe_v(530)-0.000174065*coe_v(531)-7.06681e-05*coe_v(532)-6.43222e-05*coe_v(533)+1.67862e-05*coe_v(534)-4.455e-06*coe_v(535)+0.000415153*coe_v(536)+3.71289e-05*coe_v(537)-2.8909e-05*coe_v(538)+2.57765e-05*coe_v(539)+0.000145471*coe_v(540)-0.000423735*coe_v(541)+5.37861e-05*coe_v(542)-1.55782e-05*coe_v(543)-9.95299e-05*coe_v(544)-0.000216471*coe_v(545)-0.000135526*coe_v(546)-0.000389198*coe_v(547)-0.000522124*coe_v(548)-0.00158523*coe_v(549)+0.00758624*coe_v(550)-0.00120528*coe_v(551)+1.61642e-05*coe_v(552)-5.43337e-05*coe_v(553)+0.000159337*coe_v(554)+8.27517e-05*coe_v(555)-7.88403e-05*coe_v(556)-0.000116603*coe_v(557)-7.18747e-05*coe_v(558)-0.00117747*coe_v(559)-5.37638e-05*coe_v(560)+9.64135e-05*coe_v(561)+1.74053e-05*coe_v(562)+2.83624e-05*coe_v(563)+2.55713e-05*coe_v(564)+5.54235e-05*coe_v(565)-9.18335e-05*coe_v(566)+0.000161618*coe_v(567)+0.000221465*coe_v(568)-6.96703e-05*coe_v(569)+1.33341e-05*coe_v(570)+1.6119e-05*coe_v(571)-6.43085e-06*coe_v(572)+7.41683e-05*coe_v(573)-0.000106186*coe_v(574)-8.91787e-05*coe_v(575)+2.6053e-05*coe_v(576)+2.59009e-05*coe_v(577)-4.16537e-07*coe_v(578)-2.7071e-05*coe_v(579)+3.91334e-05*coe_v(580)-9.28369e-05*coe_v(581)+1.39446e-05*coe_v(582)-1.02923e-06*coe_v(583)+1.50055e-05*coe_v(584)-3.6645e-06*coe_v(585)+1.41567e-05*coe_v(586)-6.56184e-05*coe_v(587)-8.67008e-06*coe_v(588)+0.000118903*coe_v(589)-0.000161825*coe_v(590)+0.000126323*coe_v(591)-0.000340697*coe_v(592)+0.00023193*coe_v(593)-0.000167945*coe_v(594)+0.00172733*coe_v(595)+0.000986228*coe_v(596)+9.99109e-05*coe_v(597)+5.02731e-05*coe_v(598)+2.94092e-05*coe_v(599)+0.000110929*coe_v(600)-3.75176e-05*coe_v(601)+0.000235659*coe_v(602)+0.000614519*coe_v(603)-7.69176e-05*coe_v(604)+2.476e-05*coe_v(605)-1.16809e-05*coe_v(606)-5.78396e-06*coe_v(607)-2.77004e-05*coe_v(608)-1.4787e-05*coe_v(609)-7.68913e-05*coe_v(610)+5.84534e-05*coe_v(611)+5.16539e-05*coe_v(612)-2.4581e-05*coe_v(613)-2.21927e-05*coe_v(614)-2.1831e-05*coe_v(615)-6.61547e-05*coe_v(616)-4.99564e-05*coe_v(617)-7.23576e-06*coe_v(618)+2.29536e-06*coe_v(619)-3.47554e-05*coe_v(620)-1.32324e-05*coe_v(621)-1.14377e-05*coe_v(622)+2.48926e-05*coe_v(623)-3.09971e-05*coe_v(624)+3.87082e-05*coe_v(625)+9.63136e-05*coe_v(626)+6.273e-05*coe_v(627)+6.5223e-05*coe_v(628)+0.000302741*coe_v(629)+5.30592e-05*coe_v(630)-0.000235218*coe_v(631)+0.000291939*coe_v(632)-2.29165e-05*coe_v(633)-1.08859e-05*coe_v(634)+2.63976e-05*coe_v(635)-4.24609e-05*coe_v(636)+0.000126008*coe_v(637)+0.00052439*coe_v(638)-9.14118e-05*coe_v(639)+3.62427e-05*coe_v(640)+1.7845e-05*coe_v(641)+2.83401e-05*coe_v(642)-5.40398e-06*coe_v(643)+2.81667e-05*coe_v(644)-1.21222e-05*coe_v(645)+1.06234e-05*coe_v(646)-2.72308e-05*coe_v(647)-3.9329e-05*coe_v(648)+0.00013304*coe_v(649)+5.87913e-05*coe_v(650)+9.10213e-06*coe_v(651)-9.83812e-06*coe_v(652)+0.000114243*coe_v(653)+1.41894e-05*coe_v(654)+1.25933e-05*coe_v(655)-4.27386e-05*coe_v(656)+0.000136537*coe_v(657)+3.23255e-05*coe_v(658)-0.000365764*coe_v(659)-0.000182897*coe_v(660)+2.469e-05*coe_v(661)-4.30315e-05*coe_v(662)+5.64473e-05*coe_v(663)-1.75947e-05*coe_v(664)-0.000339246*coe_v(665)-8.18805e-05*coe_v(666)+3.98294e-05*coe_v(667)-9.84757e-06*coe_v(668)+8.91191e-06*coe_v(669)+4.14125e-05*coe_v(670)-3.34834e-05*coe_v(671)+5.74824e-05*coe_v(672)-1.93073e-05*coe_v(673)+1.19504e-05*coe_v(674)-6.29813e-05*coe_v(675)+4.11503e-06*coe_v(676)+8.41777e-05*coe_v(677)-0.000108354*coe_v(678)-0.000321654*coe_v(679)-0.000230344*coe_v(680)-0.000233111*coe_v(681)-0.00014664*coe_v(682)-1.86946e-05*coe_v(683)-3.73315e-05*coe_v(684)-2.29373e-05*coe_v(685)+0.000167526*coe_v(686)+4.57928e-05*coe_v(687)+2.58991e-05*coe_v(688)+1.94729e-05*coe_v(689)+0.000202892*coe_v(690)+3.13119e-06*coe_v(691)+8.68822e-05*coe_v(692)-1.12124e-06*coe_v(693)+6.00925e-05*coe_v(694)-0.000369054*coe_v(695)+0.000739721*coe_v(696)-0.000294192*coe_v(697)-8.97852e-05*coe_v(698)+0.000251333*coe_v(699)-6.26046e-05*coe_v(700)-9.95877e-05*coe_v(701)-0.000166098*coe_v(702)+0.000340167*coe_v(703)-0.000166644*coe_v(704)-0.000214131*coe_v(705)+0.00161163*coe_v(706)+0.00031266*coe_v(707)+0.00012738*coe_v(708)-9.39775e-05*coe_v(709)-0.000170046*coe_v(710)+0.000249029*coe_v(711)+0.000930114*coe_v(712)-0.000594323*coe_v(713)+0.00138653*coe_v(714)-0.0107415*coe_v(715)+0.058273*coe_v(716)-4.81952e-05*coe_v(717)+0.00715525*coe_v(718)-0.000217313*coe_v(719)+0.00240517*coe_v(720)+0.000145819*coe_v(721)+0.00310236*coe_v(722)-0.000138548*coe_v(723)+0.00682062*coe_v(724)-0.000354984*coe_v(725)+0.06269*coe_v(726)-0.00172089*coe_v(727)-0.000130254*coe_v(728)+0.000107081*coe_v(729)-3.27986e-05*coe_v(730)+1.22846e-06*coe_v(731)-1.71544e-05*coe_v(732)+7.15879e-05*coe_v(733)-5.37249e-05*coe_v(734)-0.000172347*coe_v(735)-0.00057463*coe_v(736)+0.0070436*coe_v(737)+1.50276e-05*coe_v(738)+0.000897244*coe_v(739)-2.23564e-05*coe_v(740)+0.000526177*coe_v(741)-3.26787e-05*coe_v(742)+0.000859015*coe_v(743)+0.000153846*coe_v(744)+0.00656178*coe_v(745)-4.512e-05*coe_v(746)-9.0401e-05*coe_v(747)+6.67478e-06*coe_v(748)-1.54979e-05*coe_v(749)-1.7612e-05*coe_v(750)+2.58384e-05*coe_v(751)+8.73236e-05*coe_v(752)-0.000401867*coe_v(753)+0.00280483*coe_v(754)-7.06753e-05*coe_v(755)+0.000576253*coe_v(756)-4.80398e-06*coe_v(757)+0.000532515*coe_v(758)-8.80531e-05*coe_v(759)+0.00275194*coe_v(760)+4.72907e-05*coe_v(761)+8.59989e-05*coe_v(762)+1.60164e-05*coe_v(763)-2.12442e-06*coe_v(764)-7.40582e-05*coe_v(765)+6.37777e-05*coe_v(766)+0.00290953*coe_v(767)-3.68906e-05*coe_v(768)+0.000915175*coe_v(769)+1.27356e-05*coe_v(770)+0.00291378*coe_v(771)+0.000160132*coe_v(772)-5.98307e-05*coe_v(773)+1.75144e-05*coe_v(774)-0.000253186*coe_v(775)+0.00705096*coe_v(776)+0.000328478*coe_v(777)+0.00672494*coe_v(778)-0.000707842*coe_v(779)+0.00150642*coe_v(780)+0.0619055*coe_v(781)-0.000371893*coe_v(782)-0.000235329*coe_v(783)-2.25321e-06*coe_v(784)-9.35759e-05*coe_v(785)-0.000118353*coe_v(786)+1.99776e-05*coe_v(787)+9.02703e-05*coe_v(788)-8.63275e-05*coe_v(789)+0.000302559*coe_v(790)-0.000632685*coe_v(791)+6.83082e-05*coe_v(792)+4.49886e-05*coe_v(793)+1.47596e-05*coe_v(794)+5.36161e-05*coe_v(795)+3.39201e-05*coe_v(796)+4.86174e-05*coe_v(797)+4.98089e-05*coe_v(798)+3.09484e-06*coe_v(799)+0.000189069*coe_v(800)-4.83556e-05*coe_v(801)-3.20471e-06*coe_v(802)-5.46031e-06*coe_v(803)+1.09802e-05*coe_v(804)-2.12071e-05*coe_v(805)-2.14617e-07*coe_v(806)+3.38093e-05*coe_v(807)-2.30232e-05*coe_v(808)-1.53549e-05*coe_v(809)+2.40279e-06*coe_v(810)-1.14095e-05*coe_v(811)+7.44497e-06*coe_v(812)-7.87943e-06*coe_v(813)+8.4971e-06*coe_v(814)+5.19664e-05*coe_v(815)+7.11398e-05*coe_v(816)-2.43304e-05*coe_v(817)+5.99802e-06*coe_v(818)+2.63238e-06*coe_v(819)+3.32291e-05*coe_v(820)+4.35306e-05*coe_v(821)-4.05123e-06*coe_v(822)-1.35264e-05*coe_v(823)-8.76374e-06*coe_v(824)-2.18438e-05*coe_v(825)+3.62127e-05*coe_v(826)-1.57871e-05*coe_v(827)-2.30539e-05*coe_v(828)+9.4109e-06*coe_v(829)+2.41514e-05*coe_v(830)+0.000186886*coe_v(831)-9.82136e-05*coe_v(832)+3.62629e-05*coe_v(833)+0.000322892*coe_v(834)+0.000365276*coe_v(835)-0.000198556*coe_v(836)+0.00658785*coe_v(837)+9.73675e-06*coe_v(838)+0.000880524*coe_v(839)+6.44556e-06*coe_v(840)+0.00054961*coe_v(841)+5.18958e-06*coe_v(842)+0.000881593*coe_v(843)-9.51153e-05*coe_v(844)+0.00640291*coe_v(845)-0.00016741*coe_v(846)+2.17481e-05*coe_v(847)-3.92117e-06*coe_v(848)+5.95603e-06*coe_v(849)+9.76862e-06*coe_v(850)+1.21656e-05*coe_v(851)-2.7745e-05*coe_v(852)+5.99004e-05*coe_v(853)+0.000890207*coe_v(854)-3.93858e-06*coe_v(855)+0.000197687*coe_v(856)-1.38002e-06*coe_v(857)+0.000195575*coe_v(858)-2.66547e-05*coe_v(859)+0.000886714*coe_v(860)-2.46212e-05*coe_v(861)-2.59316e-06*coe_v(862)+8.13441e-06*coe_v(863)+1.18949e-05*coe_v(864)+2.66266e-05*coe_v(865)-3.16748e-05*coe_v(866)+0.000546839*coe_v(867)-2.02289e-05*coe_v(868)+0.000197936*coe_v(869)+1.9783e-05*coe_v(870)+0.000515264*coe_v(871)-1.01304e-05*coe_v(872)-1.70781e-05*coe_v(873)+1.4033e-05*coe_v(874)-3.58976e-06*coe_v(875)+0.000996354*coe_v(876)-3.84409e-05*coe_v(877)+0.000922163*coe_v(878)+0.000119035*coe_v(879)-0.00013267*coe_v(880)+0.00602436*coe_v(881)-5.84024e-05*coe_v(882)+9.60828e-05*coe_v(883)+1.16503e-05*coe_v(884)+7.43969e-05*coe_v(885)-7.49574e-06*coe_v(886)-1.07114e-06*coe_v(887)-4.36879e-05*coe_v(888)-0.000214101*coe_v(889)+4.49257e-05*coe_v(890)-1.27095e-05*coe_v(891)+1.48978e-05*coe_v(892)+2.03371e-05*coe_v(893)-1.12164e-05*coe_v(894)+1.79532e-05*coe_v(895)-1.42806e-06*coe_v(896)+2.52057e-05*coe_v(897)-1.8573e-05*coe_v(898)-3.12494e-06*coe_v(899)+2.64118e-06*coe_v(900)-4.50623e-06*coe_v(901)-6.20813e-05*coe_v(902)+6.92261e-07*coe_v(903)+1.28602e-05*coe_v(904)+2.50849e-06*coe_v(905)-3.73098e-06*coe_v(906)-1.03273e-05*coe_v(907)+2.48564e-05*coe_v(908)+1.16352e-05*coe_v(909)-3.35681e-06*coe_v(910)-3.44645e-05*coe_v(911)-5.27967e-05*coe_v(912)+1.70176e-05*coe_v(913)+6.08672e-06*coe_v(914)+5.06016e-05*coe_v(915)+1.61033e-05*coe_v(916)+0.000541817*coe_v(917)+0.00313503*coe_v(918)-0.000132358*coe_v(919)+0.000574225*coe_v(920)+2.05244e-05*coe_v(921)+0.000601768*coe_v(922)-4.26719e-05*coe_v(923)+0.00282934*coe_v(924)+0.000109818*coe_v(925)+5.52431e-06*coe_v(926)-3.44632e-06*coe_v(927)-1.22442e-05*coe_v(928)+8.06521e-06*coe_v(929)-9.47181e-05*coe_v(930)+0.000643331*coe_v(931)+6.60879e-06*coe_v(932)+0.000179837*coe_v(933)+1.08675e-05*coe_v(934)+0.000533232*coe_v(935)-1.45616e-05*coe_v(936)-2.7072e-05*coe_v(937)+4.00934e-06*coe_v(938)+2.5876e-06*coe_v(939)+0.000621337*coe_v(940)+1.9007e-05*coe_v(941)+0.000552475*coe_v(942)+4.14461e-05*coe_v(943)-7.98864e-05*coe_v(944)+0.0026064*coe_v(945)+0.000118159*coe_v(946)-7.88357e-05*coe_v(947)-3.18356e-05*coe_v(948)-7.19993e-06*coe_v(949)+3.32957e-05*coe_v(950)+0.000132746*coe_v(951)-5.57623e-05*coe_v(952)-8.48779e-06*coe_v(953)-1.86275e-05*coe_v(954)+7.2015e-06*coe_v(955)+0.000161292*coe_v(956)+6.14505e-05*coe_v(957)-1.61235e-06*coe_v(958)+5.76355e-06*coe_v(959)+1.4596e-05*coe_v(960)+2.62084e-05*coe_v(961)-1.8532e-05*coe_v(962)+2.99687e-05*coe_v(963)+7.57453e-05*coe_v(964)+9.14076e-05*coe_v(965)+0.000126503*coe_v(966)+0.00252101*coe_v(967)-2.0237e-05*coe_v(968)+0.000784096*coe_v(969)-2.59662e-05*coe_v(970)+0.0028859*coe_v(971)-6.22789e-05*coe_v(972)-6.01373e-06*coe_v(973)+8.03127e-06*coe_v(974)+5.10035e-05*coe_v(975)+0.000913444*coe_v(976)+2.41225e-06*coe_v(977)+0.000925199*coe_v(978)+9.04936e-05*coe_v(979)+7.5559e-05*coe_v(980)+0.00268888*coe_v(981)-0.000107894*coe_v(982)+2.41128e-05*coe_v(983)-3.28498e-05*coe_v(984)-0.000323215*coe_v(985)-4.78577e-05*coe_v(986)-1.24e-06*coe_v(987)+9.3707e-05*coe_v(988)-2.18278e-05*coe_v(989)-3.32564e-05*coe_v(990)-1.81004e-05*coe_v(991)+0.00622076*coe_v(992)-5.32589e-05*coe_v(993)+0.006427*coe_v(994)+6.81099e-05*coe_v(995)-0.000264303*coe_v(996)+0.00702097*coe_v(997)+0.000542157*coe_v(998)-0.00134208*coe_v(999)-0.000293451*coe_v(1000)+0.0541805*coe_v(1001);
obj=3.14159265359*coe(1)+0.785398163397*coe(4)+0.785398163397*coe(6)+0.392699081699*coe(11)+0.1308996939*coe(13)+0.392699081699*coe(15)+0.245436926062*coe(22)+0.0490873852123*coe(24)+0.0490873852123*coe(26)+0.245436926062*coe(28)+0.171805848243*coe(37)+0.0245436926062*coe(39)+0.0147262155637*coe(41)+0.0245436926062*coe(43)+0.171805848243*coe(45)+0.128854386182*coe(56)+0.0143171540203*coe(58)+0.00613592315154*coe(60)+0.00613592315154*coe(62)+0.0143171540203*coe(64)+0.128854386182*coe(66);
%g=0.25-x^2-y^2;
%degree=12;
%degree_w=12;
%[V,coe0]= polynomial(x1,degree);
%[w,coe]= polynomial([x y],degree_w);
%V_1=replace(V,t,T);
%V_0=replace(V,t,0);
%V1=jacobian(V,x1)*f;
%obj=(pi*(440401920*coe(1) + 27525120*coe(4) + 27525120*coe(6) + 3440640*coe(11) + 1146880*coe(13) + 3440640*coe(15) + 537600*coe(22) + 107520*coe(24) + 107520*coe(26) + 537600*coe(28) + 94080*coe(37) + 13440*coe(39) + 8064*coe(41) + 13440*coe(43) + 94080*coe(45) + 17640*coe(56) + 1960*coe(58) + 840*coe(60) + 840*coe(62) + 1960*coe(64) + 17640*coe(66) + 3465*coe(79) + 315*coe(81) + 105*coe(83) + 75*coe(85) + 105*coe(87) + 315*coe(89) + 3465*coe(91)))/1761607680;
%---------------------------------

degree1=Degree;
[s1,coe1]=polynomial(xd,degree1);
[s2,coe2]=polynomial(xd,degree1);
[s3,coe3]=polynomial(x1,degree1);
%[s4,coe4]=polynomial(x1,degree1);

%the constraint coe(1)<=0.8 is for numerical stability: generating valid under-approximations 
F=[sos(-V1+s1*h_d-s2*h),sos((1+h_1*h_1)*V-h_1-s3*h),sos(s1),sos(s2),sos(s3)];
% F=[sos(-V1-s2*h),sos((1+h_1*h_1)*V-h_1-s3*h),sos(s2),sos(s3)];
ops = sdpsettings('solver','mosek','sos.newton',1,'sos.congruence',1);
diagnostics= solvesos(F,obj,ops,[coe;coe1;coe2;coe3]);
if diagnostics.problem == 0
 disp('Solver thinks it is feasible')
elseif diagnostics.problem == 1
 disp('Solver thinks it is infeasible')
else
 disp('Something else happened')
end
%-------------------OUPUT---------------------------------------
% Output polynomials under=w(x) defining an
% under-approximation {x: under <=0} of the reach set at time T 
%----------------------------------------------------------------
double(obj);
v = monolist(x1,Degree);
% for i=1:length(v)
%     if degree(v(i)/x4,x4) >=0
%         assign(coe_v(i),0);
%     end
% end
%     
sdisplay(v'*double(coe))

